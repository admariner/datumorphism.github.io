<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Restrictions of Websites | Datumorphism</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Restrictions of Websites" />
<meta name="author" content="Datumorphism Collective" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The study of the data as a means for information about the world" />
<meta property="og:description" content="The study of the data as a means for information about the world" />
<link rel="canonical" href="http://localhost:4000/wiki/nodecrawler/restrictions/" />
<meta property="og:url" content="http://localhost:4000/wiki/nodecrawler/restrictions/" />
<meta property="og:site_name" content="Datumorphism" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-11-13T18:36:31-05:00" />
<script type="application/ld+json">
{"description":"The study of the data as a means for information about the world","author":{"@type":"Person","name":"Datumorphism Collective"},"@type":"BlogPosting","url":"http://localhost:4000/wiki/nodecrawler/restrictions/","headline":"Restrictions of Websites","dateModified":"2018-07-19T00:00:00-04:00","datePublished":"2018-11-13T18:36:31-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/wiki/nodecrawler/restrictions/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/bulma/bulma.css">
  <link rel="stylesheet" href="/assets/bulmawatch/united/bulmaswatch.min.css">
  <link rel="stylesheet" href="/assets/fontawesome/web-fonts-with-css/css/fontawesome-all.min.css">
  <link rel="stylesheet" href="/assets/code/base16-solarized.light.css">


  <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: { extensions: ["color.js","cancel.js", "AMSmath.js", "AMSsymbols.js"] },
      messageStyle: "none"
   });
  </script>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
    MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
      cancel: ["Extension","cancel"]
      });
   });
   </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
        inlineMath: [['$','$'], ['\\(','\\)']]
      }
    });
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      processEscapes: true
    }
  });
</script>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: {
      Macros: {
        overlr: ['\\overset\\leftrightarrow{\#1}',1],
        overl: ['\\overset\leftarrow{\#1}',1],
        overr: ['\\overset\rightarrow{\#1}',1],
        bra: ['\\left\\langle \#1\\right|',1],
        ket: ['\\left| \#1\\right\\rangle',1],
        braket: ['\\langle \#1 \\mid \#2 \\rangle',2],
        avg: ['\\left< \#1 \\right>',1],
        slashed: ['\\cancel{\#1}',1],
        bold: ['\\boldsymbol{\#1}',1],
        sech: ['\\operatorname{sech}{\#1}',1],
        csch: ['\\operatorname{csch}{\#1}',1]
      }
    }
  });
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


  <!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css"> --><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Datumorphism" /></head>
<body><header class="site-header" role="banner"><section class="hero is-primary is-medium">
    <!-- Hero head: will stick at the top -->
    <!-- <div class="hero-head"> -->
      <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="container">
          <div class="navbar-brand">
            <a class="navbar-item has-text-weight-bold" rel="author" href="/">Datumorphism</a>
            <!-- <img src="https://bulma.io/images/bulma-type-white.png" alt="Logo"> -->
            <span class="navbar-burger burger" data-target="navbarMenuHeroA">
            <span></span>
            <span></span>
            <span></span>
            </span>
          </div>
          <div id="navbarMenuHeroA" class="navbar-menu">
            <div class="navbar-end">

              <a class="navbar-item has-text-weight-bold" href="/"><i class="fas fa-home"></i></a>

              
              
              <a class="navbar-item has-text-weight-bold" href="http://localhost:4000/til/" >TIL</a>
              
              
              <a class="navbar-item has-text-weight-bold" href="http://localhost:4000/wiki/" >Wiki</a>
              
              
              <a class="navbar-item has-text-weight-bold" href="http://localhost:4000/reading/" >Reading</a>
              
              
              <a class="navbar-item has-text-weight-bold" href="http://localhost:4000/awesome/" >Awesome</a>
              
              
              <a class="navbar-item has-text-weight-bold" href="http://localhost:4000/blog/" >Blog</a>
              

              

               
              
              
              
              
              
              
              
              <a class="navbar-item has-text-weight-bold" href="/about/">About</a>
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              
              

            </div>
          </div>
        </div>
      </nav>
    <!-- </div> -->
  </section>
  <script>
  document.addEventListener('DOMContentLoaded', function () {

  // Get all "navbar-burger" elements
  var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

  // Check if there are any navbar burgers
  if ($navbarBurgers.length > 0) {

    // Add a click event on each of them
    $navbarBurgers.forEach(function ($el) {
      $el.addEventListener('click', function () {

        // Get the target from the "data-target" attribute
        var target = $el.dataset.target;
        var $target = document.getElementById(target);

        // Toggle the class on both the "navbar-burger" and the "navbar-menu"
        $el.classList.toggle('is-active');
        $target.classList.toggle('is-active');

      });
    });
  }

});
  </script>

</header>
<main class="main--content" aria-label="Content">
    <div class="columns">
      <div class="column is-12">
        <div class="content is-medium">
          <article class="post">

  <header class="post-header">
    <h1 class="post-title has-text-centered is-size-1" itemprop="name headline">Restrictions of Websites</h1>
    <p class="post-meta has-text-centered">
      <time class="dt-published" datetime="2018-11-13T18:36:31-05:00" itemprop="datePublished">Nov 13, 2018
      </time>
       • <span style="font-style: regular;">{</span>
       <span style="padding-right: 0.2em;padding-left: 0.2em;"><a href="http://localhost:4000/wiki/#node-crawler">⸢Node Crawler⸥</a></span>
       
       }
      
      
       • <span style="font-style: regular;">[</span>
       <span style="padding-right: 0.2em;padding-left: 0.2em;"><a href="http://localhost:4000/wiki/?keywords=Node">#Node</a></span>
       
       <span style="padding-right: 0.2em;padding-left: 0.2em;"><a href="http://localhost:4000/wiki/?keywords=Crawler">#Crawler</a></span>
       
       ]
      
      
      <article class="message">
        <div class="message-header">
          <p>Source:</p>
        </div>
        <div class="message-body">
          <ul>
          
            <li><a href="" style="text-decoration:none;">04-应对网站的限制@ninthakeey</a></li>
          
          </ul>
        </div>
      </article>
      
      
      <div class="notification is-primary">
         The original Chinese article is written by ninthakeey. It has been translated and remixed by Datumorphism
       </div>
      
    </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Beware that scraping data off websites is neither always allowed nor as easy as a few lines of code. The preceding articles enable you to scrape many data, however, website have counter measures. In this article, we will be dealing with some of the common ones.</p>

<h2 id="request-frequency">Request Frequency</h2>

<p>Some websites have limitations on the frequency of API requests. The solution to this is simply a brief pause after each request. In Node.js, the function <a href="https://www.w3schools.com/jsref/met_win_setinterval.asp"><code class="highlighter-rouge">setInterval</code></a> enables this.</p>

<pre><code class="language-JavaScript">// ... require packages here

// define the function fetch to get data
const fetch = (aid) =&gt; superagent
		.get('https://api.bilibili.com/x/web-interface/archive/stat')
		.query({ aid:aid })
		.then(res =&gt; {
			const data = res.body.data
			dao.saveData(data, (err,res)=&gt;{
				console.log('saved data, aid=' + aid)
			})
		})
		.catch(err =&gt; console.error(err))
// fetch data for every 2000ms
// increment aid to scrape other aid's
let aid = 26186448
setInterval(() =&gt; fetch(aid++), 2000)
</code></pre>

<div class="card">
<header class="card-header">
<p class="card-header-title card-toggle">setInterval</p>
</header>
<div class="card-content is-hidden">
<div class="content">
      <p><code class="highlighter-rouge">setInterval</code> is used as</p>
      <pre><code class="language-JavaScript">setInterval(function(){ alert("Hello"); }, 3000);
</code></pre>
      <p>The function inside is a callback function.</p>

      <p>As mentioned previously, <code class="highlighter-rouge">() =&gt; </code> defines a function. In our case, we have called the function <code class="highlighter-rouge">fetch</code> increment <code class="highlighter-rouge">aid</code> using <code class="highlighter-rouge">aid++</code>.</p>
    </div>
</div>
</div>

<p>Node.js provides other approaches such as the new ES8 syntax <code class="highlighter-rouge">async/await</code> which make it possible to rewrite the code into function chaining again.</p>
<pre><code class="language-JavaScript">// create a new Promise object
const sleep = (ms) =&gt; new Promise((suc,fail) =&gt; setTimeout(suc, ms));
(async ()=&gt;{
	for(;;){
		await sleep(2000)
		console.log(new Date())
	}
})()
</code></pre>
<p>This piece of code will print out the date and time every 2000ms.</p>

<div class="card">
<header class="card-header">
<p class="card-header-title card-toggle">async/await</p>
</header>
<div class="card-content is-hidden">
<div class="content">
      <p>Node.js is single-threaded. As we have mentioned when explaining the function <code class="highlighter-rouge">fs.writeFile()</code>, Node.js has non-blocking I/O. In fact, concurrency is probably at the heart of Node.js, which means we execute one process out of the multiple running processes. Concurrency can make your code more efficient.</p>

      <p>In the first block of code, we have used <code class="highlighter-rouge">setInterval</code> callback function. However, callback is kind of messy. It’s much better if we could use function chaining. <code class="highlighter-rouge">Promise</code> is exactly what we need to achieve this.</p>

      <p><code class="highlighter-rouge">async</code> tells Node.js that we are defining an asynchronous function, while <code class="highlighter-rouge">await</code> tells it to wait for the async function to parse things. It’s basically an alternative to <code class="highlighter-rouge">.then</code> and <code class="highlighter-rouge">.catch</code> functions.</p>

      <p>The code above doesn’t chain functions a lot but it’s worth mentioning here.</p>

      <p><a href="https://medium.com/platformer-blog/node-js-concurrency-with-async-await-and-promises-b4c4ae8f4510">This article</a> explains the concurrency in Node.js pretty well.</p>
    </div>
</div>
</div>

<h2 id="user-agent-verification">User-Agent Verification</h2>

<p>Some services will require some certain browsers to get a successfull response. The way they do it is to verify the <code class="highlighter-rouge">User-Agent</code> (UA) data in the HTTP requests. In this case, we have to request with some fake UA data.</p>

<p>The package <code class="highlighter-rouge">superagent</code> can help us set UA.</p>
<pre><code class="language-JavaScript">superagent
	.get('https://api.bilibili.com/x/web-interface/archive/stat')
	.set({ 'User-Agent': 'Opera/9.80 balabala...' }) // set User-Agent here
	.query({ aid:aid })
	.then(res =&gt; {
		// do something
	})
	.catch(err =&gt; console.error(err))
</code></pre>

<p>It would be even better if we could change UA everytime. Here is a list of UA.</p>

<pre><code class="language-JavaScript">const USER_AGENTS = [
    'Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.12) Gecko/20070731 Ubuntu/dapper-security Firefox/1.5.0.12',
    'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Acoo Browser; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506)',
    'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11',
    'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/535.20 (KHTML, like Gecko) Chrome/19.0.1036.7 Safari/535.20',
    'Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.8) Gecko Fedora/1.9.0.8-1.fc10 Kazehakase/0.5.6',
    'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.71 Safari/537.1 LBBROWSER',
    'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0) ,Lynx/2.8.5rel.1 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/1.2.9',
    'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)',
    'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; QQBrowser/7.0.3698.400)',
    'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)',
    'Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b13pre) Gecko/20110307 Firefox/4.0b13pre',
    'Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto/2.9.168 Version/11.52',
    'Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.12) Gecko/20070731 Ubuntu/dapper-security Firefox/1.5.0.12',
    'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; LBBROWSER)',
    'Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.8) Gecko Fedora/1.9.0.8-1.fc10 Kazehakase/0.5.6',
    'Mozilla/5.0 (X11; U; Linux; en-US) AppleWebKit/527+ (KHTML, like Gecko, Safari/419.3) Arora/0.6',
    'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; QQBrowser/7.0.3698.400)',
    'Opera/9.25 (Windows NT 5.1; U; en), Lynx/2.8.5rel.1 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/1.2.9',
    'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36'
];
</code></pre>

  </div>

  <a class="u-url" href="/wiki/nodecrawler/restrictions/" hidden></a>





<div class="is-clearfix"></div>

<nav class="pagination is-centered" role="navigation" aria-label="pagination">
  <ul class="pagination-list">
    
    





    
    
    <li style="list-style:none;">
      <a class="pagination-link " aria-label="Introduction to Node Crawler Series" aria-current="page" href="/wiki/nodecrawler/node-crawler-introduction/">1</a>
    </li>
<!--
<div class="columns">

<div class="column">

</div>


<div class="column">
  
</div>
 -->







    
    
    <li style="list-style:none;">
      <a class="pagination-link " aria-label="Basic Node Crawler" aria-current="page" href="/wiki/nodecrawler/basic-crawler/">2</a>
    </li>
<!--
<div class="columns">

<div class="column">

</div>


<div class="column">
  
</div>
 -->





    
        <a class="pagination-previous" href="/wiki/nodecrawler/manage-data-using-mongodb/" title="Manage Data Using MongoDB">Previous</a>
    
    
    <li style="list-style:none;">
      <a class="pagination-link " aria-label="Manage Data Using MongoDB" aria-current="page" href="/wiki/nodecrawler/manage-data-using-mongodb/">3</a>
    </li>
<!--
<div class="columns">

<div class="column">

</div>


<div class="column">
  
      <strong><a class="post-link" href="/wiki/nodecrawler/manage-data-using-mongodb/">Manage Data Using MongoDB</a></strong>
  
</div>
 -->





    
    
    <li style="list-style:none;">
      <a class="pagination-link is-current" aria-label="Restrictions of Websites" aria-current="page" href="/wiki/nodecrawler/restrictions/">4</a>
    </li>
<!--
<div class="columns">

<div class="column">

</div>


<div class="column">
  
</div>
 -->





    
    
        <a class="pagination-next" href="/wiki/nodecrawler/optimization/" title="Optimization">Next</a>
    
    <li style="list-style:none;">
      <a class="pagination-link " aria-label="Optimization" aria-current="page" href="/wiki/nodecrawler/optimization/">5</a>
    </li>
<!--
<div class="columns">

<div class="column">

</div>


<div class="column">
  
</div>
 -->


</ul>
</nav>


</article>

        </div>
      </div>
    </div>
    </main><footer class="footer">
  <data class="u-url" href="/"></data>
  <div class="container">
    <div class="content has-text-centered">
      <p>
        <strong>Datumorphism</strong> by <a>Datumorphism Collective</a>.
       <span class="icon">
         <a href="https://github.com/datumorphism"><i class="fab fa-github"></i></a>
       </span>
       <span class="icon">
      <a href="/feed.xml"><i class="fas fa-rss"></i></a>
       </span>
      </p>

    </div>
  </div>
</footer>
<!-- <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
<script src="/assets/js/home-chart.js"></script> -->

<script src="/assets/js/collapse.js"></script>

</body>

</html>
